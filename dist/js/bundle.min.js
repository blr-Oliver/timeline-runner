function toggleDirective(){return{restrict:"C",$scope:!1,link:function(t,e,i){var n=angular.element("<label>").attr("for",i.id);e.after(n),t.$on("$destroy",function(){n.remove()})}}}function settingsDirective(){function t(t,e,i){var n=t.taskList=e.taskList,r=t.settings=e.settings;t.$watch("taskList.length",function(t,e){if(t>e)for(var s=e;s<t;++s)n[s]=new i,n[s].status="pending";t<=r.editing&&(r.editing=null)}),t.$watch('taskList | pluck : "duration"',function(t){r.total=t&&t.reduce(function(t,e){return t+e},0)},!0),this.startEdit=function(t){t<n.length&&(r.editing=t)}}return t.$inject=["$scope","model","Task"],{restrict:"A",scope:!0,templateUrl:"templates/settings.html",controller:t,controllerAs:"settingsCtrl"}}function progressDirective(){var t=2;function e(e,i){e.taskList=i.taskList;var n=e.progress=i.progress;e.$watch('taskList | pluck : "duration"',function(e){var i=e.reduce(function(t,e){return t+e},0);n.items=e.map(function(n){var r=n/i*(100-t*e.length)+t;return Math.round(1e3*r)/1e3})},!0)}return e.$inject=["$scope","model"],{restrict:"A",scope:!0,templateUrl:"templates/progress.html",controller:e,controllerAs:null}}function donutDirective(){return{restrict:"E",templateUrl:"templates/donut.html",replace:!0,scope:{value:"<",stroke:"<"}}}function displayDirective(){function t(t,e){var i=t.taskList=e.taskList,n=t.display=e.display,r=t.progress=e.display.progress,s=function(){++n.active};r.on("alarm",s),t.$watch("display.active",function(t){r.reset(),null===t&&(t=-1),i.forEach(function(e,i){switch(Math.sign(i-t)){case-1:e.status="completed";break;case 0:e.status="active";break;case 1:e.status="pending"}}),t>=0&&t<i.length?r.limit=i[n.active].duration:r.stop()}),t.$watch("taskList.length",function(t){n.active=n.active&&Math.min(n.active,t)}),t.$on("$destroy",function(){r.off("alarm",s)})}return t.$inject=["$scope","model"],{restrict:"A",scope:!0,templateUrl:"templates/display.html",controller:t,controllerAs:null}}function controlsDirective(t){function e(){}return e.$inject=[],e.prototype={previous:function(){null!==t.display.active&&t.display.active>=0&&(0===t.display.active?t.display.progress.reset():--t.display.active)},play:function(){(null===t.display.active||t.display.active>=t.taskList.length)&&(t.display.active=0),t.display.progress.start()},pause:function(){t.display.progress.stop()},stop:function(){t.display.active=null,t.display.progress.stop(),t.display.progress.reset()},next:function(){null!==t.display.active&&t.display.active<t.taskList.length?++t.display.active:t.display.active=0}},{restrict:"AE",scope:!0,templateUrl:"templates/controls.html",controller:e,controllerAs:"player"}}function progressTimerFactory(t,e){function i(e,i,n){t.call(this),Object.defineProperties(this,{$rate:{writable:!0,value:i>=1?~~+i:1},$consumed:{writable:!0,value:0},$capacity:{writable:!0},$timer:{writable:!0,value:null},$silent:{writable:!0,value:!!n}}),this.limit=e}var n=function(){this.$consumed=0},r=function(t){this.$consumed=l(this.$consumed+t*this.$rate,0,this.$capacity)},s=function(t){this.$consumed=l(t*this.$rate,0,this.$capacity)},o=function(t){this.$consumed=Math.floor(this.value*t),this.$capacity=Math.ceil(this.$capacity/this.$rate*t),this.$rate=t},a=function(t){this.$capacity=t*this.$rate,this.$consumed=l(this.$consumed,0,this.$capacity)},c=function(t){this.$silent=t};return i.prototype={start:function(){if(!this.running)if(this.started=Date.now(),this.$silent)this.$timer=!0;else{var t=this;this.$timer=e(function(){t.$alarm()},this.timeLeft)}},stop:function(){this.running&&(this.$consumed=this.timePassed,this.$silent||e.cancel(this.$timer),this.$timer=null)},reset:function(){this.pauseAndExec(n)},adjust:function(t){this.pauseAndExec(r,t)},pauseAndExec:function(t){var e;return this.running?(this.stop(),e=t.apply(this,Array.prototype.slice.call(arguments,1)),this.start()):e=t.apply(this,Array.prototype.slice.call(arguments,1)),e}},Object.defineProperties(i.prototype,{$alarm:{value:function(){this.timeLeft>0?this.pauseAndExec(angular.noop):this.trigger("alarm")}},running:{enumerable:!0,get:function(){return!!this.$timer}},value:{enumerable:!0,get:function(){return this.timePassed/this.$rate},set:function(t){this.pauseAndExec(s,t)}},rate:{enumerable:!0,get:function(){return this.$rate},set:function(t){t=t>=1?~~+t:1,this.pauseAndExec(o,t)}},limit:{enumerable:!0,get:function(){return this.$capacity/this.$rate},set:function(t){t=t>=0?~~+t:0,this.pauseAndExec(a,t)}},timePassed:{enumerable:!0,get:function(){return l(this.running?this.$consumed+Date.now()-this.started:this.$consumed,0,this.$capacity)}},timeLeft:{enumerable:!0,get:function(){return this.$capacity-this.timePassed}},silent:{enumerable:!0,get:function(){return this.$silent},set:function(t){(t=!!t)!==this.$silent&&this.pauseAndExec(c,t)}}}),t.mixin(i.prototype),i;function l(t,e,i){return null==e&&(e=-1/0),null==i&&(i=1/0),Math.max(e,Math.min(t,i))}}function emitterFactory(){return t.prototype={on:function(t,e){var i;return t in this.listeners||(this.listeners[t]=[]),~(i=this.listeners[t]).indexOf(e)||i.push(e),this},off:function(t,e){var i=this.listeners[t];if(i&&i.length){var n=i.indexOf(e);~n&&i.splice(n,1)}return this},one:function(t,e){return this.on(t,function t(){return e.apply(this.off(t),arguments)})},trigger:function(t){var e=this.listeners[t],i=Array.prototype.slice.call(arguments);return e&&e.length&&e.forEach(function(t){t.apply(this,i)},this),this}},t.mixin=function(e,i){for(var n in t.prototype)t.prototype.hasOwnProperty(n)&&(e[n]=t.prototype[n]);!i&&t.call(e)},t;function t(){this.listeners={}}}function TaskPlayerCtrl(t,e,i){i.loop(angular.noop,null,t)}function TaskFactory(){return function(t,e,i){this.name=t||"Task",this.description=e||"",this.duration=i||1}}function taskListFactory(t,e){var i,n="task-list",r=localStorage.getItem(n);if(null!=r)try{i=JSON.parse(r).map(function(t){return new e(t.name,t.description,t.duration)})}catch(t){console.warn("Couldn't deserialize stored task list")}return i||(i=[new e("Open settings","Click on control panel to open settings",1),new e("Set number of tasks","Set number of tasks from 1 to 10",2),new e("Define your tasks","Click on each token and give every task a name",5),new e("Describe each task","Add detailed description to each task",10),new e("Define task durations","Use slider to set task duration or input it manually",3),new e("Review","Progress bar on the top can help with durations",3),new e("Start session",'Close settings and click "Play" button',1),new e("Control timeline","Use player navigation buttons to control session flow if necessary",1)]),t.$watch(function(){return i},function(t){localStorage.setItem(n,JSON.stringify(i,function(t,e){if(!t||"$"!==t[0])return e}))},!0),i}function displayFactory(t){return{active:null,progress:new t(1,6e4)}}function settingsFactory(){return{open:!1,total:1,editing:null}}function progressFactory(){return{items:[]}}function modelFactory(t,e,i,n){return{taskList:t,display:e,settings:i,progress:n}}function initRootScope(t,e){t.model=e}angular.module("ui",["toggle","donut"]).filter("sequence",function(){var t=[];return function(e){return t[e]||(t[e]=Array.apply(0,Array(e)).map(function(t,e){return e}))}}).filter("pluck",function(){return function(t,e){return t&&t.map(function(t){return t&&t[e]})}}),angular.module("toggle",[]).directive("toggle",toggleDirective),toggleDirective.$inject=[],angular.module("ui").directive("settings",settingsDirective),settingsDirective.$inject=[],angular.module("ui").directive("taskProgress",progressDirective),progressDirective.$inject=[],angular.module("donut",[]).directive("donut",donutDirective),donutDirective.$inject=[],angular.module("ui").directive("display",displayDirective),displayDirective.$inject=[],angular.module("ui").directive("controls",controlsDirective),controlsDirective.$inject=["model"],angular.module("raf",[]).factory("raf",["$window","$rootScope",function(t,e){var i=t.requestAnimationFrame,n=t.cancelAnimationFrame;function r(t,r,s){var o=!1===s;s=s||e;var a=i(o?r?t.bind(r):t:t&&function(e){s.$apply(function(){t.call(r||this,e)})});return function(){n(a)}}return r.loop=function(t,r,s){var o,a,c,l,u=!1===s;return s=s||e,u?c=function(e){t.call(r||this,e),o=i(c)}:(l=function(){t.call(r||this,a)},c=function(t){a=t,s.$apply(l),o=i(c)}),o=i(t&&c),function(){c=angular.noop,n(o)}},r}]),angular.module("progress-timer",["emitter"]).factory("ProgressTimer",progressTimerFactory),progressTimerFactory.$inject=["Emitter","$timeout"],angular.module("emitter",[]).factory("Emitter",emitterFactory),emitterFactory.$inject=[],angular.module("main",["progress-timer","raf","ui"]).controller("TaskPlayerCtrl",TaskPlayerCtrl).factory("Task",TaskFactory).factory("taskList",taskListFactory).factory("display",displayFactory).factory("settings",settingsFactory).factory("progress",progressFactory).factory("model",modelFactory).run(initRootScope),TaskPlayerCtrl.$inject=["$rootScope","model","raf"],TaskFactory.$inject=[],taskListFactory.$inject=["$rootScope","Task"],displayFactory.$inject=["ProgressTimer"],settingsFactory.$inject=[],progressFactory.$inject=[],modelFactory.$inject=["taskList","display","settings","progress"],initRootScope.$inject=["$rootScope","model"],angular.module("dropbox-id",[]).constant("dropboxId","evsw8r72d00f86s");